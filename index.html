<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fußball-Ergebnisse</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #004494;
        }

        #loading {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            padding: 20px;
        }

        .match {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fff;
        }

        .match-meta {
            text-align: center;
            font-size: 0.9em;
            color: #777;
            margin-bottom: 10px;
        }

        .match-details {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 1.2em;
            font-weight: bold;
        }

        .team {
            display: flex;
            align-items: center;
            text-align: center;
        }

        .team-name {
            margin: 0 10px;
        }

        .team-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .score-container {
            text-align: center;
            white-space: nowrap;
        }

        .score-status {
            display: block;
            font-size: 0.8em;
            font-weight: normal;
            margin-top: 5px;
        }

        .status-live {
            color: red;
            font-weight: bold;
        }

        .status-finished {
            color: #555;
        }

        .status-upcoming {
            color: #888;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Fußball-Ergebnisse</h1>
        <div id="loading">Lade Spieldaten...</div>
        <div id="results-container"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultsContainer = document.getElementById('results-container');
            const loadingIndicator = document.getElementById('loading');
            
            const API_URL = 'https://www.openligadb.de/api/getmatchdata/bl1/2025';
            const PROXY_URL = 'https://corsproxy.io/?' + encodeURIComponent(API_URL);

            function createMatchElement(match) {
                const matchDiv = document.createElement('div');
                matchDiv.classList.add('match');

                const metaDiv = document.createElement('div');
                metaDiv.classList.add('match-meta');
                
                const matchDate = new Date(match.MatchDateTime);
                const dateString = matchDate.toLocaleDateString('de-DE');
                const timeString = matchDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                const venueName = match.Location && match.Location.LocationName ? match.Location.LocationName : 'Ort unbekannt';
                metaDiv.textContent = `${dateString}, ${timeString} Uhr | Stadion: ${venueName}`;

                const detailsDiv = document.createElement('div');
                detailsDiv.classList.add('match-details');

                // Heimteam-Informationen mit zusätzlicher Prüfung
                const homeTeamDiv = document.createElement('div');
                homeTeamDiv.classList.add('team');
                const homeLogo = document.createElement('img');
                homeLogo.classList.add('team-logo');
                homeLogo.src = match.Team1 && match.Team1.TeamIconUrl ? match.Team1.TeamIconUrl : '';
                const homeName = document.createElement('span');
                homeName.classList.add('team-name');
                homeName.textContent = match.Team1 && match.Team1.TeamName ? match.Team1.TeamName : 'Heimteam';
                homeTeamDiv.appendChild(homeLogo);
                homeTeamDiv.appendChild(homeName);
                
                // Auswärtsteam-Informationen mit zusätzlicher Prüfung
                const awayTeamDiv = document.createElement('div');
                awayTeamDiv.classList.add('team');
                const awayName = document.createElement('span');
                awayName.classList.add('team-name');
                awayName.textContent = match.Team2 && match.Team2.TeamName ? match.Team2.TeamName : 'Auswärtsteam';
                const awayLogo = document.createElement('img');
                awayLogo.classList.add('team-logo');
                awayLogo.src = match.Team2 && match.Team2.TeamIconUrl ? match.Team2.TeamIconUrl : '';
                awayTeamDiv.appendChild(awayName);
                awayTeamDiv.appendChild(awayLogo);

                const scoreContainer = document.createElement('div');
                scoreContainer.classList.add('score-container');
                const scoreSpan = document.createElement('span');
                const statusSpan = document.createElement('span');
                statusSpan.classList.add('score-status');

                let statusText = 'ANSTEHEND';
                let scoreText = ' - ';

                if (match.IsFinished) {
                    statusText = 'BEENDET';
                    const finalResult = match.MatchResults.find(result => result.ResultName === 'Endergebnis');
                    if (finalResult) {
                        scoreText = `${finalResult.PointsTeam1} - ${finalResult.PointsTeam2}`;
                    }
                    statusSpan.classList.add('status-finished');
                } else {
                    const now = new Date();
                    if (now > matchDate) {
                        statusText = 'LIVE';
                        statusSpan.classList.add('status-live');
                    } else {
                        statusSpan.classList.add('status-upcoming');
                    }
                    scoreText = ' - ';
                }
                
                scoreSpan.textContent = scoreText;
                statusSpan.textContent = statusText;

                scoreContainer.appendChild(scoreSpan);
                scoreContainer.appendChild(statusSpan);

                detailsDiv.appendChild(homeTeamDiv);
                detailsDiv.appendChild(scoreContainer);
                detailsDiv.appendChild(awayTeamDiv);

                matchDiv.appendChild(metaDiv);
                matchDiv.appendChild(detailsDiv);

                return matchDiv;
            }

            function fetchMatches() {
                fetch(PROXY_URL)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Netzwerkantwort war nicht OK');
                        }
                        return response.json();
                    })
                    .then(data => {
                        loadingIndicator.style.display = 'none';
                        
                        const sortedMatches = data.sort((a, b) => {
                            const aGroup = a.Group && a.Group.GroupOrderID ? a.Group.GroupOrderID : Infinity;
                            const bGroup = b.Group && b.Group.GroupOrderID ? b.Group.GroupOrderID : Infinity;
                            if (aGroup !== bGroup) {
                                return aGroup - bGroup;
                            }
                            return new Date(a.MatchDateTime) - new Date(b.MatchDateTime);
                        });

                        sortedMatches.forEach(match => {
                            const matchElement = createMatchElement(match);
                            resultsContainer.appendChild(matchElement);
                        });
                    })
                    .catch(error => {
                        console.error('Fehler beim Abrufen der Daten:', error);
                        loadingIndicator.textContent = 'Fehler beim Laden der Spieldaten.';
                    });
            }

            fetchMatches();
        });
    </script>
</body>
</html>